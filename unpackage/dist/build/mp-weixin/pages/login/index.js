"use strict";const e=require("../../common/vendor.js"),a=require("../../api/api.js"),l=require("../../utils/utils.js"),o=require("../../enum/user.js"),t=require("../../utils/wx.js");require("../../utils/http.js");const i={__name:"index",setup(i){const n=new a.Api;e.ref();const r=e.ref(!1),u=e.reactive({email:"",code:""}),s=e.ref(0);e.ref("");const v=e.ref();e.ref();const c=e.ref(60),d=e.ref(!1);let g;const m=e.ref(0),f=e.ref(0),h=e.ref(!1);e.onShow((()=>{1===s.value&&(h.value=!0)}));const w=async()=>{if(d.value)return;if(!l.isValidEmail(u.email))return void t.toast("输入正确邮箱之后再获取");t.showLoading("获取中...");const e=await n.sendEmail({email:u.email});if(t.hideLoading(),t.toast(e.message),d.value=!0,200===e.code)return j(),void(s.value=1);clearInterval(g),d.value=!1,c.value=60},j=()=>{g=setInterval((()=>{if(0===c.value)return clearInterval(g),d.value=!1,void(c.value=60);c.value--}),1e3)},p=async()=>{if(!l.isValidEmail(u.email))return void t.toast("邮箱格式不正确");if(!u.code||6!==u.code.length)return void t.toast("验证码格式不正确");t.showLoading("处理中..."),r.value=!0;const a=await n.emailLogin(u);if(t.hideLoading(),r.value=!1,200===a.code)return r.value=!1,v.value=a.data,t.setStorage(o.USER_INFO,a.data),void e.index.navigateTo({url:"/pages/home/index"});t.toast(a.message)};e.watch((()=>u.code),((e,a)=>{6!==e.length?0!==e.length?e.length>a.length?m.value=e.length:e.length<a.length&&(m.value=e.length-1):m.value=0:p()}));(async()=>{const a=await e.index.login();console.log(a)})();const x=async a=>{if(console.log("获取手机号",a),"getPhoneNumber:ok"===a.detail.errMsg){const l=a.detail.code,o=await e.index.login(),t=await n.wechatLogin({mobile_code:l,open_id_code:o.code});200===t.code&&console.log(t)}},q=()=>{f.value=s.value,1===s.value&&(h.value=!0)},L=()=>{h.value=!1};return(a,l)=>e.e({a:e.o(x),b:0===f.value,c:e.o(w),d:u.email,e:e.o((e=>u.email=e.detail.value)),f:h.value,g:e.o(p),h:e.o(L),i:u.code,j:e.o((e=>u.code=e.detail.value)),k:d.value},d.value?{l:e.t(c.value)}:{},{m:e.o(w),n:`translateX(-${100*s.value}vw)`,o:e.o(q)})}};wx.createPage(i);
