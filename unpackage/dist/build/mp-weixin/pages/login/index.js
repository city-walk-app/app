"use strict";const e=require("../../common/vendor.js"),a=require("../../api/api.js"),t=require("../../utils/utils.js"),l=require("../../enum/user.js"),i=require("../../utils/wx.js");require("../../utils/http.js"),Math||o();const o=()=>"../../uni_modules/lime-confetti/components/l-confetti/l-confetti.js",n={__name:"index",setup(o){const n=new a.Api,u=e.ref(),r=e.ref(!1),s=e.reactive({email:"",code:""}),v=e.ref(0);e.ref("");const c=e.ref();e.ref(""),e.ref();const d=e.ref(60),f=e.ref(!1);let m;const g=e.ref(0),h=e.ref(0),w=e.ref(!1);e.onShow((()=>{1===v.value&&(w.value=!0)}));const j=async()=>{if(f.value)return;if(!t.isValidEmail(s.email))return void i.toast("输入正确邮箱之后再获取");i.showLoading("获取中...");const e=await n.sendEmail({email:s.email});if(i.hideLoading(),i.toast(e.message),f.value=!0,200===e.code)return p(),void(v.value=1);clearInterval(m),f.value=!1,d.value=60},p=()=>{m=setInterval((()=>{if(0===d.value)return clearInterval(m),f.value=!1,void(d.value=60);d.value--}),1e3)},q=async()=>{if(!t.isValidEmail(s.email))return void i.toast("邮箱格式不正确");if(!s.code||6!==s.code.length)return void i.toast("验证码格式不正确");i.showLoading("处理中..."),r.value=!0;const a=await n.emailLogin(s);if(i.hideLoading(),r.value=!1,200===a.code)return r.value=!1,c.value=a.data,i.setStorage(l.USER_INFO,a.data),void e.index.navigateTo({url:"/pages/home/index"});i.toast(a.message)};e.watch((()=>s.code),((e,a)=>{6!==e.length?0!==e.length?e.length>a.length?g.value=e.length:e.length<a.length&&(g.value=e.length-1):g.value=0:q()}));const x=()=>{h.value=v.value,1===v.value&&(w.value=!0)},L=()=>{w.value=!1};return(a,t)=>e.e({a:e.sr(u,"04ed244c-0",{k:"confettiRef"}),b:0===h.value,c:e.o(j),d:s.email,e:e.o((e=>s.email=e.detail.value)),f:w.value,g:e.o(q),h:e.o(L),i:s.code,j:e.o((e=>s.code=e.detail.value)),k:f.value},f.value?{l:e.t(d.value)}:{},{m:e.o(j),n:`translateX(-${100*v.value}vw)`,o:e.o(x)})}};wx.createPage(n);
