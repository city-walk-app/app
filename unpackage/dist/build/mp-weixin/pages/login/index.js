"use strict";const e=require("../../common/vendor.js"),a=require("../../api/api.js"),t=require("../../utils/utils.js"),o=require("../../enum/user.js"),l=require("../../utils/wx.js");require("../../utils/http.js"),Math||i();const i=()=>"../../uni_modules/lime-confetti/components/l-confetti/l-confetti.js",n={__name:"index",setup(i){const n=new a.Api;(async()=>{const a=await e.index.login();console.log(a)})();const r=e.ref(),s=e.ref(!1),u=e.reactive({email:"",code:""}),c=e.ref(0);e.ref("");const d=e.ref();e.ref(""),e.ref();const v=e.ref(60),g=e.ref(!1);let f;const m=e.ref(0),h=e.ref(0),w=e.ref(!1);e.onShow((()=>{1===c.value&&(w.value=!0)}));const p=async()=>{if(g.value)return;if(!t.isValidEmail(u.email))return void l.toast("输入正确邮箱之后再获取");l.showLoading("获取中...");const e=await n.sendEmail({email:u.email});if(l.hideLoading(),l.toast(e.message),g.value=!0,200===e.code)return j(),void(c.value=1);clearInterval(f),g.value=!1,v.value=60},j=()=>{f=setInterval((()=>{if(0===v.value)return clearInterval(f),g.value=!1,void(v.value=60);v.value--}),1e3)},x=async()=>{if(!t.isValidEmail(u.email))return void l.toast("邮箱格式不正确");if(!u.code||6!==u.code.length)return void l.toast("验证码格式不正确");l.showLoading("处理中..."),s.value=!0;const a=await n.emailLogin(u);if(l.hideLoading(),s.value=!1,200===a.code)return s.value=!1,d.value=a.data,l.setStorage(o.USER_INFO,a.data),void e.index.navigateTo({url:"/pages/home/index"});l.toast(a.message)};e.watch((()=>u.code),((e,a)=>{6!==e.length?0!==e.length?e.length>a.length?m.value=e.length:e.length<a.length&&(m.value=e.length-1):m.value=0:x()}));const _=async a=>{if(console.log("获取手机号",a),"getPhoneNumber:ok"===a.detail.errMsg){const t=a.detail.code,o=await e.index.login(),l=await n.wechatLogin({mobile_code:t,open_id_code:o.code});200===l.code&&console.log(l)}},q=()=>{h.value=c.value,1===c.value&&(w.value=!0)},L=()=>{w.value=!1};return(a,t)=>e.e({a:e.sr(r,"6d2e9cf6-0",{k:"confettiRef"}),b:e.o(_),c:0===h.value,d:e.o(p),e:u.email,f:e.o((e=>u.email=e.detail.value)),g:w.value,h:e.o(x),i:e.o(L),j:u.code,k:e.o((e=>u.code=e.detail.value)),l:g.value},g.value?{m:e.t(v.value)}:{},{n:e.o(p),o:`translateX(-${100*c.value}vw)`,p:e.o(q)})}};wx.createPage(n);
