"use strict";const e=require("../../common/vendor.js"),a=require("../../api/api.js"),t=require("../../utils/utils.js"),l=require("../../enum/user.js"),o=require("../../utils/wx.js");require("../../utils/http.js"),Math||i();const i=()=>"../../uni_modules/lime-confetti/components/l-confetti/l-confetti.js",n={__name:"index",setup(i){const n=new a.Api,u=e.ref(),r=e.ref(!1),s=e.reactive({email:"",code:""}),c=e.ref(0);e.ref("");const d=e.ref();e.ref();const v=e.ref(60),g=e.ref(!1);let f;const m=e.ref(0),h=e.ref(0),w=e.ref(!1);e.onShow((()=>{1===c.value&&(w.value=!0)}));const p=async()=>{if(g.value)return;if(!t.isValidEmail(s.email))return void o.toast("输入正确邮箱之后再获取");o.showLoading("获取中...");const e=await n.sendEmail({email:s.email});if(o.hideLoading(),o.toast(e.message),g.value=!0,200===e.code)return j(),void(c.value=1);clearInterval(f),g.value=!1,v.value=60},j=()=>{f=setInterval((()=>{if(0===v.value)return clearInterval(f),g.value=!1,void(v.value=60);v.value--}),1e3)},x=async()=>{if(!t.isValidEmail(s.email))return void o.toast("邮箱格式不正确");if(!s.code||6!==s.code.length)return void o.toast("验证码格式不正确");o.showLoading("处理中..."),r.value=!0;const a=await n.emailLogin(s);if(o.hideLoading(),r.value=!1,200===a.code)return r.value=!1,d.value=a.data,o.setStorage(l.USER_INFO,a.data),void e.index.navigateTo({url:"/pages/home/index"});o.toast(a.message)};e.watch((()=>s.code),((e,a)=>{6!==e.length?0!==e.length?e.length>a.length?m.value=e.length:e.length<a.length&&(m.value=e.length-1):m.value=0:x()}));(async()=>{const a=await e.index.login();console.log(a)})();const _=async a=>{if(console.log("获取手机号",a),"getPhoneNumber:ok"===a.detail.errMsg){const t=a.detail.code,l=await e.index.login(),o=await n.wechatLogin({mobile_code:t,open_id_code:l.code});200===o.code&&console.log(o)}},q=()=>{h.value=c.value,1===c.value&&(w.value=!0)},L=()=>{w.value=!1};return(a,t)=>e.e({a:e.sr(u,"6d2e9cf6-0",{k:"confettiRef"}),b:e.o(_),c:0===h.value,d:e.o(p),e:s.email,f:e.o((e=>s.email=e.detail.value)),g:w.value,h:e.o(x),i:e.o(L),j:s.code,k:e.o((e=>s.code=e.detail.value)),l:g.value},g.value?{m:e.t(v.value)}:{},{n:e.o(p),o:`translateX(-${100*c.value}vw)`,p:e.o(q)})}};wx.createPage(n);
