"use strict";const e=require("../../common/vendor.js"),o=require("../../api/api.js"),n=require("../../enum/user.js"),i=require("../../utils/positioning.js"),s=require("../../utils/wx.js");require("../../utils/http.js");const a={__name:"index",setup(a){const t=new o.Api,{getAround:l}=i.usePositioning(),c=e.ref(0);e.index.getMenuButtonBoundingClientRect();const d=e.ref(s.getStorage(n.USER_INFO)),g=async o=>{const i=await t.getOpenId({code:o});200===i.code&&(async o=>{const i=await t.loginOpenId({wx_open_id:o});s.toast(i.message),200===i.code?(s.setStorage(n.USER_INFO,i.data),d.value=i.data):e.index.navigateTo({url:"/pages/login/index"})})(i.data.openid)},r=async()=>{const o=await e.index.login();"login:ok"===o.errMsg&&g(o.code)},u=l((async o=>{const{address:n,latitude:i,longitude:a,name:l}=o,c=await t.locationCreateRecord({latitude:i,longitude:a});s.toast(c.message),200===c.code&&e.index.navigateTo({url:"/pages/record-success/index"})})),x=e.ref(39.909),v=e.ref(116.39742),p=()=>{e.index.navigateTo({url:"/pages/setting/index"})},f=()=>{e.index.navigateTo({url:`/pages/mine/index?user_id=${d.value.user_id}`})},y=()=>{e.index.navigateTo({url:"/pages/login/index"})},m=()=>{e.index.navigateTo({url:"/pages/friends/index"})},w=()=>{e.index.navigateTo({url:"/pages/invite/index"})},_=()=>{e.index.navigateTo({url:"/pages/ranking/index"})};return e.onLoad((o=>{o.invite_id&&(async o=>{console.log("获取详情");const n=await t.getFriendInviteInfo({invite_id:o});console.log(n),200===n.code&&e.index.showModal({title:"好友申请",content:`${n.data.name} 申请加你为好友，你同意吗？`,showCancel:!0,cancelText:"拒绝",confirmText:"同意",success:async e=>{if(e.confirm){const e=await t.friendConfirmInvite({invite_id:o});200===e.code&&console.log(e),console.log("同意")}else e.cancel&&console.log("用户点击取消")}})})(o.invite_id)})),e.onShow((()=>{e.index.onGyroscopeChange((e=>{console.log("陀螺仪.x = "+e.x),console.log("陀螺仪.y = "+e.y),console.log("陀螺仪.z = "+e.z)})),e.index.startGyroscope({interval:"normal",success(){console.log("success")},fail(){console.log("fail")}})})),e.onHide((()=>{e.index.stopGyroscope({success(){console.log("stop success!")},fail(){console.log("stop fail!")}})})),d&&d.value&&d.value.user_id?(console.log("已经登录"),(()=>{const o=e.index.getSystemInfoSync();c.value=o.statusBarHeight+44})(),e.index.getLocation({type:"wgs84",success:async e=>{console.log("获取用户位置信息成功:",e),v.value=e.longitude,x.value=e.latitude},fail:e=>{console.log("获取用户位置信息失败:",e)}})):console.log("未登录"),(o,n)=>({a:e.o(f),b:e.o(p),c:e.o(r),d:e.o(y),e:x.value,f:v.value,g:e.o(m),h:e.o(((...o)=>e.unref(u)&&e.unref(u)(...o))),i:e.o(w),j:e.o(_),k:(c.value||90)+"px"})}};wx.createPage(a);
