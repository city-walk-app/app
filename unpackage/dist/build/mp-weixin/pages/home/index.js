"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),n=require("../../api/api.js"),a=require("../../enum/user.js"),t=require("../../utils/wx.js"),i=require("../../store/global/index.js");require("../../utils/http.js");const s={__name:"index",setup(s){const l=new n.Api,c=i.useGlobalStore();console.log(c);const d=e.ref(0),r=e.ref(),g=e.ref(),u=e.ref(),v=e.ref(t.getStorage(a.USER_INFO)),x=async o=>{const n=await l.getOpenId({code:o});200===n.code&&(async o=>{const n=await l.loginOpenId({wx_open_id:o});t.toast(n.message),200===n.code?(t.setStorage(a.USER_INFO,n.data),v.value=n.data):e.index.navigateTo({url:"/pages/login/index"})})(n.data.openid)},p=async()=>{const o=await e.index.login();"login:ok"===o.errMsg&&x(o.code)},m=async()=>{const o=await e.index.chooseLocation({type:"gcj02"});if("chooseLocation:ok"!==o.errMsg)return void t.toast("查看位置错误");const{latitude:n,longitude:a,name:i,address:s}=o;200===(await l.locationCreateRecord({latitude:n,longitude:a})).code&&e.index.navigateTo({url:"/pages/record-success/index"})},_=async()=>{const e=await l.getLocationPopularRecommend({longitude:g.value,latitude:r.value});200===e.code&&e.data&&e.data.length&&(e=>{console.log(e);const o=e.map(((e,o)=>({iconPath:"https://city-walk.oss-cn-beijing.aliyuncs.com/assets/images/city-walk/home-markers.svg",width:50,height:50,id:o,latitude:e.latitude,longitude:e.longitude})));u.value=o})(e.data)},w=()=>{e.index.navigateTo({url:"/pages/setting/index"})},y=()=>{e.index.navigateTo({url:`/pages/mine/index?user_id=${v.value.user_info.user_id}`})},f=()=>{e.index.navigateTo({url:"/pages/login/index"})},h=()=>{e.index.navigateTo({url:"/pages/friends/index"})},j=()=>{e.index.navigateTo({url:"/pages/invite/index"})},T=()=>{e.index.navigateTo({url:"/pages/ranking/index"})};e.onLoad((o=>{o.invite_id&&(async o=>{console.log("获取详情");const n=await l.getFriendInviteInfo({invite_id:o});console.log(n),200===n.code&&e.index.showModal({title:"好友申请",content:`${n.data.name} 申请加你为好友，你同意吗？`,showCancel:!0,cancelText:"拒绝",confirmText:"同意",success:async e=>{if(e.confirm){const e=await l.friendConfirmInvite({invite_id:o});200===e.code&&console.log(e),console.log("同意")}else e.cancel&&console.log("用户点击取消")}})})(o.invite_id)})),e.onShow((()=>{(async()=>{const o=await e.index.getLocation({type:"gcj02",isHighAccuracy:!0});"getLocation:ok"===o.errMsg?(g.value=o.longitude,r.value=o.latitude,_()):t.toast("获取地理位置失败")})()})),console.log(v.value),v&&v.value&&v.value.user_id?(console.log("已经登录"),(()=>{const o=e.index.getSystemInfoSync();d.value=o.statusBarHeight+44})()):console.log("未登录");const k=e=>{console.log("点击标记的点触发",e)},q=e=>{console.log("点击地图触发",e)},I=e=>{console.log("点击地图poi点时触发",e)},S=e=>{console.log("视野发生变化时触发",e)},L=async()=>{e.index.createMapContext("map").moveToLocation()};return(n,a)=>e.e({a:e.o(y),b:o._imports_0,c:e.o(w),d:o._imports_1,e:o._imports_2,f:e.o(L),g:e.o(p),h:e.o(f),i:r.value&&g.value},r.value&&g.value?{j:r.value,k:g.value,l:u.value,m:e.o(k),n:e.o(q),o:e.o(I),p:e.o(S)}:{},{q:e.o(h),r:e.o(j),s:e.o(m),t:e.o(T),v:(d.value||90)+"px"})}};wx.createPage(s);
