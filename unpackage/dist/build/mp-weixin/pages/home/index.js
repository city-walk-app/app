"use strict";const e=require("../../common/vendor.js"),n=require("../../api/api.js"),i=require("../../enum/user.js"),o=require("../../utils/positioning.js"),a=require("../../utils/wx.js");require("../../utils/http.js");const t={__name:"index",setup(t){const s=new n.Api,{getAround:d}=o.usePositioning(),l=e.ref(0);e.index.getMenuButtonBoundingClientRect();const c=e.ref(a.getStorage(i.USER_INFO)),g=async n=>{const o=await s.getOpenId({code:n});200===o.code&&(async n=>{const o=await s.loginOpenId({wx_open_id:n});a.toast(o.message),200===o.code?(a.setStorage(i.USER_INFO,o.data),c.value=o.data):e.index.navigateTo({url:"/pages/login/index"})})(o.data.openid)},r=async()=>{const n=await e.index.login();"login:ok"===n.errMsg&&g(n.code)},u=d((async n=>{const{address:i,latitude:o,longitude:t,name:d}=n,l=await s.locationCreateRecord({latitude:o,longitude:t});a.toast(l.message),200===l.code&&e.index.navigateTo({url:"/pages/record-success/index"})})),x=e.ref(39.909),v=e.ref(116.39742),p=()=>{e.index.navigateTo({url:"/pages/setting/index"})},f=()=>{e.index.navigateTo({url:`/pages/mine/index?user_id=${c.value.user_id}`})},m=()=>{e.index.navigateTo({url:"/pages/login/index"})},w=()=>{e.index.navigateTo({url:"/pages/friends/index"})},_=()=>{e.index.navigateTo({url:"/pages/invite/index"})},y=()=>{e.index.navigateTo({url:"/pages/ranking/index"})};return e.onLoad((n=>{n.invite_id&&(async n=>{console.log("获取详情");const i=await s.getFriendInviteInfo({invite_id:n});console.log(i),200===i.code&&e.index.showModal({title:"好友申请",content:`${i.data.name} 申请加你为好友，你同意吗？`,showCancel:!0,cancelText:"拒绝",confirmText:"同意",success:async e=>{if(e.confirm){const e=await s.friendConfirmInvite({invite_id:n});200===e.code&&console.log(e),console.log("同意")}else e.cancel&&console.log("用户点击取消")}})})(n.invite_id)})),c&&c.value&&c.value.user_id?(console.log("已经登录"),(()=>{const n=e.index.getSystemInfoSync();l.value=n.statusBarHeight+44})(),e.index.getLocation({type:"wgs84",success:async e=>{console.log("获取用户位置信息成功:",e),v.value=e.longitude,x.value=e.latitude},fail:e=>{console.log("获取用户位置信息失败:",e)}})):console.log("未登录"),(n,i)=>({a:e.o(f),b:e.o(p),c:e.o(r),d:e.o(m),e:x.value,f:v.value,g:e.o(w),h:e.o(((...n)=>e.unref(u)&&e.unref(u)(...n))),i:e.o(_),j:e.o(y),k:(l.value||90)+"px"})}};wx.createPage(t);
