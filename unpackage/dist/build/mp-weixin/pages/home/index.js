"use strict";const e=require("../../common/vendor.js"),n=require("../../api/api.js"),o=require("../../enum/user.js"),i=require("../../utils/positioning.js"),t=require("../../utils/wx.js");require("../../utils/http.js");const a={__name:"index",setup(a){const s=new n.Api,{getAround:c}=i.usePositioning();e.ref(),e.ref(!1);const l=e.ref(0);e.index.getMenuButtonBoundingClientRect();const r=e.ref(t.getStorage(o.USER_INFO)),d=c((async n=>{const{address:o,latitude:i,longitude:a,name:c}=n,l=await s.locationCreateRecord({latitude:i,longitude:a});t.toast(l.message),200===l.code&&e.index.navigateTo({url:"/pages/record-success/index"})})),g=()=>{e.index.navigateTo({url:"/pages/setting/index"})},u=()=>{e.index.navigateTo({url:"/pages/mine/index"})},x=()=>{e.index.navigateTo({url:"/pages/friends/index"})},p=()=>{e.index.navigateTo({url:"/pages/invite/index"})},v=()=>{e.index.navigateTo({url:"/pages/ranking/index"})},f=async()=>{try{const n=await e.index.getClipboardData();"getClipboardData:ok"===n.errMsg&&(console.log("读取成功：",n.data),n.data.includes("CityWalk:")&&(console.log(n.data.replace(/CityWalk:/g,"")),(async n=>{console.log("获取详情");const o=await s.getFriendInviteInfo({invite_id:n});console.log(o),200===o.code&&e.index.showModal({title:"好友申请",content:`${o.data.name} 申请加你为好友，你同意吗？`,showCancel:!0,cancelText:"拒绝",confirmText:"同意",success:async e=>{if(e.confirm){const e=await s.friendConfirmInvite({invite_id:n});200===e.code&&console.log(e),console.log("同意")}else e.cancel&&console.log("用户点击取消")}})})(n.data.replace(/CityWalk:/g,""))))}catch(n){console.warn("剪贴板读取异常",n)}};return e.onShow((()=>{f()})),r&&r.value&&r.value.user_id?(console.log("已经登录"),(()=>{const n=e.index.getSystemInfoSync();l.value=n.statusBarHeight+44})(),e.index.getLocation({type:"wgs84",success:async e=>{console.log("获取用户位置信息成功:",e)},fail:e=>{console.log("获取用户位置信息失败:",e)}})):(console.log("未登录"),e.index.navigateTo({url:"/pages/login/index"})),(n,o)=>({a:e.o(u),b:e.o(g),c:e.o(x),d:e.o(((...n)=>e.unref(d)&&e.unref(d)(...n))),e:e.o(p),f:e.o(v),g:(l.value||90)+"px"})}};wx.createPage(a);
