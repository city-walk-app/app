"use strict";const e=require("../../common/vendor.js"),o=require("../../api/api.js"),n=require("../../enum/user.js"),i=require("../../utils/wx.js");require("../../utils/http.js");const t={__name:"index",setup(t){const a=new o.Api,s=e.ref(0),c=e.ref(39.909),l=e.ref(116.39742),d=e.ref([]);e.index.getMenuButtonBoundingClientRect();const r=e.ref(i.getStorage(n.USER_INFO)),g=async o=>{const t=await a.getOpenId({code:o});200===t.code&&(async o=>{const t=await a.loginOpenId({wx_open_id:o});i.toast(t.message),200===t.code?(i.setStorage(n.USER_INFO,t.data),r.value=t.data):e.index.navigateTo({url:"/pages/login/index"})})(t.data.openid)},u=async()=>{const o=await e.index.login();"login:ok"===o.errMsg&&g(o.code)},v=async()=>{const o=await e.index.chooseLocation({type:"gcj02"});if("chooseLocation:ok"!==o.errMsg)return void i.toast("查看位置错误");const{latitude:n,longitude:t,name:s,address:c}=o;200===(await a.locationCreateRecord({latitude:n,longitude:t})).code&&e.index.navigateTo({url:"/pages/record-success/index"})},x=()=>{e.index.navigateTo({url:"/pages/setting/index"})},p=()=>{e.index.navigateTo({url:`/pages/mine/index?user_id=${r.value.user_id}`})},f=()=>{e.index.navigateTo({url:"/pages/login/index"})},w=()=>{e.index.navigateTo({url:"/pages/friends/index"})},h=()=>{e.index.navigateTo({url:"/pages/invite/index"})},y=()=>{e.index.navigateTo({url:"/pages/ranking/index"})};return e.onLoad((o=>{o.invite_id&&(async o=>{console.log("获取详情");const n=await a.getFriendInviteInfo({invite_id:o});console.log(n),200===n.code&&e.index.showModal({title:"好友申请",content:`${n.data.name} 申请加你为好友，你同意吗？`,showCancel:!0,cancelText:"拒绝",confirmText:"同意",success:async e=>{if(e.confirm){const e=await a.friendConfirmInvite({invite_id:o});200===e.code&&console.log(e),console.log("同意")}else e.cancel&&console.log("用户点击取消")}})})(o.invite_id)})),e.onShow((()=>{(async()=>{const o=await e.index.getLocation({type:"gcj02",isHighAccuracy:!0});"getLocation:ok"===o.errMsg?(l.value=o.longitude,c.value=o.latitude,d.value.push({id:1,latitude:o.latitude,longitude:o.longitude,iconPath:"/assets/svg/about.svg",width:30,height:30,callout:{content:"我现在在这里",color:"#333",fontSize:24,borderRadius:30,bgColor:"#fff",padding:20},label:{content:"地点1",color:"red",fontSize:18}})):i.toast("获取地理位置失败")})(),e.index.onGyroscopeChange((e=>{})),e.index.startGyroscope({interval:"normal",success(){console.log("success")},fail(){console.log("fail")}})})),e.onHide((()=>{e.index.stopGyroscope({success(){console.log("stop success!")},fail(){console.log("stop fail!")}})})),r&&r.value&&r.value.user_id?(console.log("已经登录"),(()=>{const o=e.index.getSystemInfoSync();s.value=o.statusBarHeight+44})()):console.log("未登录"),(o,n)=>({a:e.o(p),b:e.o(x),c:e.o(u),d:e.o(f),e:c.value,f:l.value,g:d.value,h:e.o(w),i:e.o(v),j:e.o(h),k:e.o(y),l:(s.value||90)+"px"})}};wx.createPage(t);
