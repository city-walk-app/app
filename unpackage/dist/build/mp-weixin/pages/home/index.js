"use strict";const e=require("../../common/vendor.js"),a=require("../../api/api.js"),t=require("../../utils/http.js"),n=require("../../utils/positioning.js"),o=require("../../utils/wx.js"),i=require("../../enum/user.js"),c=require("../../utils/echarts.js");Math||(s+r)();const s=()=>"../../uni_modules/lime-echart/components/l-echart/l-echart.js",r=()=>"../../components/city-dialog/index.js",l={__name:"index",setup(s){const r=new a.Api,{getAround:l}=n.usePositioning(),u=e.ref(o.getStorage(i.USER_PROVINCE_CODE)),d=e.ref(),g=e.ref(),p=e.ref(),v=e.ref(!1),_=e.ref(0);e.index.getMenuButtonBoundingClientRect();const m=e.inject("userInfoStorage"),x=l((async e=>{const{address:a,latitude:t,longitude:n,name:i}=e,c=await r.createPositionRecord({address:a,latitude:t,longitude:n,name:i});o.toast(c.message),200===c.code&&(c.data.new_province&&(v.value=!0,p.value=c.data.new_province),f())})),f=()=>{e.index.getLocation({type:"wgs84",success:async e=>{console.log("获取用户位置信息成功:",e);const{longitude:a,latitude:n}=e,c=await r.getLocationInfo({longitude:a,latitude:n});200===c.code&&(c.data.province_banner=`${t.VUE_APP_API_URL}/images/province/${c.data.province_code}.png`,u.value=c.data,o.setStorage(i.USER_PROVINCE_CODE,c.data),(async()=>{const e=await r.getExperience({province_code:u.value.province_code});200===e.code&&(g.value=e.data)})(),w())},fail:e=>{console.log("获取用户位置信息失败:",e)}})},w=async()=>{await e.nextTick$1(),d.value.init(c.echarts,(async e=>{e.showLoading();const a=await(async()=>{const e=await r.getMapData({code:u.value.province_code});return 200===e.code?e.data:[]})();c.echarts.registerMap("CHINA_MAP",a),e.hideLoading();const t={series:[{name:"中国地图",type:"map",map:"CHINA_MAP",itemStyle:{borderColor:"none",areaColor:"lightskyblue"},data:[{name:u.value.province,value:2e3}]}]};e.setOption(t)}))},y=()=>{e.index.navigateTo({url:"/pages/setting/index"})},h=()=>{v.value=!1};console.log(m.value),m.value&&m.value.id&&((()=>{const a=e.index.getSystemInfoSync();_.value=a.statusBarHeight+44})(),f());const P=()=>{e.index.navigateTo({url:"/pages/footprint/index"})},j=()=>{e.index.navigateTo({url:"/pages/supporter/index"})};return(a,n)=>e.e({a:e.sr(d,"7b8e640a-0",{k:"mapWrapperRef"}),b:e.o(y),c:e.f(g.value,((a,t,n)=>({a:e.t(a.value),b:e.n({"experience-item-collecting":a.collecting}),c:t,d:e.o((e=>(async(e,a)=>{const t=await r.collectExperience({id:e});g.value[a].collecting=!0,200===t.code&&f()})(a.id,t)),t)}))),d:e.o(((...a)=>e.unref(x)&&e.unref(x)(...a))),e:e.o(P),f:e.o(j),g:(_.value||90)+"px",h:p.value},p.value?{i:e.t(p.value.province_name),j:`${e.unref(t.VUE_APP_API_URL)}/images/province/${p.value.province_code}.png`,k:e.o(h)}:{},{l:e.p({visible:v.value})})}};wx.createComponent(l);
